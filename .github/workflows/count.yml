name: Count PRs modifying src/test
on:
  workflow_dispatch:

jobs:
  count-prs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Count merged PRs touching src/test
        id: count
        run: |
          COUNT=$(gh pr list --repo Compass-Digital-Engineering/system-tests --state merged --limit 2000 --json number | \
          jq -r '.[].number' | \
          while read pr; do
            gh pr view $pr --repo Compass-Digital-Engineering/system-tests --json files | \
            jq -e '.files[].path | select(startswith("src/test/"))' > /dev/null && echo $pr
          done | wc -l)
          echo "count=$COUNT" >> $GITHUB_OUTPUT
          echo "Total merged PRs modifying src/test: $COUNT"

      - name: Print result
        run: echo "Total merged PRs modifying src/test: ${{ steps.count.outputs.count }}"
